<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <title>KBS TV - Receptor Oficial</title>
    
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; background: #000; font-family: 'Segoe UI', Roboto, sans-serif; color: white; cursor: pointer; }
        .layer { position: absolute; overflow: hidden; transition: 0.3s ease-out; }
        
        /* PLAYER ANTI-TRAVA PREENCHIDO */
        .video-js { width: 100% !important; height: 100% !important; }
        .vjs-tech { object-fit: fill !important; } 

        /* DESIGN DAS NOT√çCIAS */
        .news-box { padding: 15px; box-sizing: border-box; display: flex; flex-direction: column; }
        .news-card { background: #1e293b; border-radius: 20px; overflow: hidden; box-shadow: 0 15px 30px rgba(0,0,0,0.4); animation: fadeIn 0.8s ease; flex: 1; display: flex; flex-direction: column; margin-bottom: 15px; }
        .news-card img { width: 100%; height: 45%; object-fit: cover; }
        .content { padding: 20px; }
        .tag { background: #d32f2f; padding: 5px 12px; border-radius: 6px; font-size: 0.8rem; display: inline-block; margin-bottom: 10px; text-transform: uppercase; font-weight: bold; }
        .title { font-size: 1.6rem; font-weight: bold; margin-bottom: 10px; line-height: 1.2; }
        .summary { font-size: 1rem; opacity: 0.8; }

        /* CLIMA DETALHADO */
        #weather-panel { display: none; height: 100%; padding: 25px; box-sizing: border-box; animation: fadeIn 1s ease; text-align: center; background: #0f172a; border-radius: 20px; }
        .current-weather { 
            display: flex; justify-content: space-around; align-items: center; 
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%); 
            padding: 20px; border-radius: 30px; margin-bottom: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); text-align: left; 
        }
        .temp-grande { font-size: 4.5rem; font-weight: bold; color: #f59e0b; line-height: 1; }
        .chart-container { height: 180px; background: rgba(30, 41, 59, 0.5); padding: 15px; border-radius: 20px; margin-bottom: 15px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body onclick="ativarAudio()">

    <div id="v-layer" class="layer">
        <video id="player" class="video-js vjs-default-skin" playsinline autoplay></video>
    </div>
    
    <div id="n-layer" class="layer news-box">
        <div id="rotator" style="height: 100%;"></div>
        
        <div id="weather-panel">
            <h1 style="font-size: 1.5rem; margin-bottom: 15px; text-align: left;">Previs√£o do Tempo: Curitiba</h1>
            <div class="current-weather">
                <div>
                    <div class="temp-grande" id="current-temp">--¬∞C</div>
                    <div style="font-size: 1.1rem; opacity: 0.8;">Agora</div>
                </div>
                <div style="font-size: 1.2rem; line-height: 1.8;">
                    <div>üíß Humidade: <span id="humidity">--</span>%</div>
                    <div>üí® Vento: <span id="wind">--</span> km/h</div>
                </div>
            </div>
            <div class="chart-container"><canvas id="weatherChart"></canvas></div>
        </div>
    </div>

<script>
    // URL do Stream
    const streamUrl = "https://srv3.zcast.com.br/kbstv/kbstv/playlist.m3u8";

    // Inicializa√ß√£o do Player com Auto Play e √Åudio Ativo
    const p1 = videojs('player', { 
        controls: false, 
        autoplay: 'any', 
        muted: false,
        preload: 'auto'
    });

    p1.src({ src: streamUrl, type: "application/x-mpegURL" });

    // Fun√ß√£o para liberar √°udio no clique
    function ativarAudio() {
        p1.muted(false);
        p1.play();
        console.log("√Åudio liberado pelo usu√°rio.");
    }

    // --- SISTEMA ANTI-TRAVA (Watchdog) ---
    let lastTime = -1;
    let freezeCount = 0;

    setInterval(() => {
        let currentTime = p1.currentTime();
        if (currentTime === lastTime && !p1.paused()) {
            freezeCount++;
            if (freezeCount > 2) { // ~10 segundos parado
                console.warn("Stream travado. Reiniciando player...");
                p1.src({ src: streamUrl, type: "application/x-mpegURL" });
                p1.play();
                freezeCount = 0;
            }
        } else {
            freezeCount = 0;
        }
        lastTime = currentTime;
    }, 5000);
    // ------------------------------------------------

    // In√≠cio autom√°tico
    p1.ready(() => {
        p1.play().catch(() => console.log("Autoplay aguardando intera√ß√£o."));
    });

    // L√≥gica para carregar o restante do seu conte√∫do (Not√≠cias/Clima)
    // Aqui voc√™ deve manter ou inserir suas fun√ß√µes de Fetch de not√≠cias e tempo.
</script>
</body>
</html>
